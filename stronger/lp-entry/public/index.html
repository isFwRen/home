<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <link rel="stylesheet" href="<%= BASE_URL %>styles/lp-common.css">
  <title>
    <%= htmlWebpackPlugin.options.title %>
  </title>

  <style>
    body {
      position: relative;
    }

    .wrapper {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;

    }

    .loader {
      --cell-size: 52px;
      --cell-spacing: 1px;
      --cells: 3;
      --total-size: calc(var(--cells) * (var(--cell-size) + 2 * var(--cell-spacing)));
      display: flex;
      flex-wrap: wrap;
      width: var(--total-size);
      height: var(--total-size);
    }

    .cell {
      flex: 0 0 var(--cell-size);
      margin: var(--cell-spacing);
      background-color: transparent;
      box-sizing: border-box;
      border-radius: 4px;
      animation: 1.5s ripple ease infinite;
    }

    .cell.d-1 {
      animation-delay: 100ms;
    }

    .cell.d-2 {
      animation-delay: 200ms;
    }

    .cell.d-3 {
      animation-delay: 300ms;
    }

    .cell.d-4 {
      animation-delay: 400ms;
    }

    .cell:nth-child(1) {
      --cell-color: #424242;
    }

    .cell:nth-child(2) {
      --cell-color: #616161;
    }

    .cell:nth-child(3) {
      --cell-color: #757575;
    }

    .cell:nth-child(4) {
      --cell-color: #9E9E9E;
    }

    .cell:nth-child(5) {
      --cell-color: #BDBDBD;
    }

    .cell:nth-child(6) {
      --cell-color: #E0E0E0;
    }

    .cell:nth-child(7) {
      --cell-color: #EEEEEE;
    }

    .cell:nth-child(8) {
      --cell-color: #F5F5F5;
    }

    .cell:nth-child(9) {
      --cell-color: #FAFAFA;
    }

    /*Animation*/
    @keyframes ripple {
      0% {
        background-color: transparent;
      }

      30% {
        background-color: var(--cell-color);
      }

      60% {
        background-color: transparent;
      }

      100% {
        background-color: transparent;
      }
    }

    .progress {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      margin: auto;
      z-index: 100;
      background: rgba(0, 0, 0, 0.2);

      .bar {
        color: #fff;
        font-size: 28px;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        position: relative;
        top: -300px;

        .percen {
          color: red;
        }
      }
    }
  </style>
</head>

<body>
  <noscript>
    <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled.
        Please enable it to continue.</strong>
  </noscript>
  <div id="app">
    <div class="wrapper">
      <div class="loader">
        <div class="cell d-0"></div>
        <div class="cell d-1"></div>
        <div class="cell d-2"></div>
        <div class="cell d-1"></div>
        <div class="cell d-2"></div>
        <div class="cell d-2"></div>
        <div class="cell d-3"></div>
        <div class="cell d-3"></div>
        <div class="cell d-4"></div>
      </div>
    </div>
    <!-- built files will be auto injected -->
    <script src="<%= BASE_URL %>myjs/socket.io_4.7.2.min.js"></script>
    <script>
      const reg = /isApp=true/;
      if (reg.test(location.href) && (location.pathname === '/login' || location.pathname === '/')) {

        // const progressNode = document.createElement('div')
        // const barNode = document.createElement('div')
        // const percenNode = document.createElement('span')
        // progressNode.setAttribute('class', 'progress')
        // barNode.setAttribute('class', 'bar')
        // progressNode.appendChild(barNode);
        // barNode.textContent = '开始加载0%';
        // document.body.appendChild(progressNode);

        const socket = io("http://127.0.0.1:30080");
        // if (!socket.connected) {
        //   document.body.removeChild(progressNode);
        // }
        socket.on('connect', () => {
          console.log("connected renderer");
        });
        socket.on("update", (data) => {
          const text = (data.current * 100 / data.total).toFixed(2) + "%";
          console.log(text, data, 'update')
          //barNode.textContent = ('加载中' + text) ?? '开始加载0%';
          if (data.action == "结束更新") {
            console.log('结束更新')
            //document.body.removeChild(progressNode);
          }
        });
        socket.on('error', (e) => {
          console.log(e, error);
          //barNode.textContent = '加载失败';
          // setTimeout(() => {
          //   document.body.removeChild(progressNode);
          // }, 1000)
        })
      }

    </script>
</body>


</html>