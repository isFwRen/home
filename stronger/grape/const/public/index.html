<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>durian</title>
	<link rel="stylesheet" href="lib/7.scoped.css">
	<link rel="stylesheet" href="site.css">
</head>

<body class="win7">
<aside>
	<ul class="tree-view has-connector has-collapse-button has-container has-scrollbar">
		<li>
			<a href="/" onclick="event.preventDefault(),window.scrollTo(0,0),history.replaceState({},0,'/')">ç®€ä»‹</a>
		</li>
		<li>
			<details open="">
				<summary>å®¢æˆ·ç«¯æ¥å£</summary>
				<ul>
					<li>
						<a href="#list">è·å–å¸¸é‡è¡¨æ¸…å•</a>
					</li>
					<li>
						<a href="#search">åˆ†é¡µæŸ¥è¯¢</a>
					</li>
					<li>
						<a href="#status">åŒæ­¥çŠ¶æ€</a>
					</li>
				</ul>
			</details>
		</li>
		<li>
			<details open="">
				<summary>åç«¯ç®¡ç†æ¥å£</summary>
				<ul>
					<li>
						<a href="#import">å¯¼å…¥å¸¸é‡è¡¨</a>
					</li>
					<li>
						<a href="#insert">æ·»åŠ å¸¸é‡</a>
					</li>
					<li>
						<a href="#edit">ä¿®æ”¹å¸¸é‡</a>
					</li>
					<li>
						<a href="#delete">åˆ é™¤å¸¸é‡</a>
					</li>
					<li>
						<a href="#drop-table">åˆ é™¤å¸¸é‡è¡¨</a>
					</li>
					<li>
						<a href="#export">å¯¼å‡ºå¸¸é‡è¡¨</a>
					</li>
					<li>
						<a href="#release">å‘å¸ƒæ›´æ–°</a>
					</li>
				</ul>
			</details>
		</li>
	</ul>
</aside>


<main>

<h2><img class="emoji" src="icon.webp" /> durian å¸¸é‡æ•°æ®åº“æœåŠ¡</h2>

<code>
å…³äºæµ‹è¯•

å¯åœ¨åŒä¸åŒçš„ä¸»æœºä¸Šåˆ†å¼€è¿è¡Œ duriand å’Œ duriandã€‚å¦‚æœåœ¨åŒä¸€å°è®¾å¤‡ä¸Šè¿è¡Œï¼Œéœ€è¦é˜²æ­¢ç«¯å£å†²çªã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªæµ‹è¯•çš„ä¾‹å­ï¼š

```sh
# è¿è¡ŒæœåŠ¡å™¨èŠ‚ç‚¹ duriand
# åœ¨ 192.168.1.61 ä¸Šå¯åŠ¨ duriand
# è®¿é—® http://192.168.1.61:30080/?api_token=... å¯ä»¥ç®¡ç†å¸¸é‡è¡¨
# å¯†é’¥æ˜¯å¿…é¡»çš„ï¼Œå¯æ”¾åœ¨æŸ¥è¯¢å‚æ•° ?api_token=... æˆ– httpå¤´ Authorization: Bearer ...
# é™é€Ÿ20kæ˜¯ä¸ºäº†é™ä½æ•°æ®åŒæ­¥çš„é€Ÿåº¦ï¼Œæ–¹ä¾¿æµ‹è¯•å’Œè§‚å¯Ÿ
DURIAN_HOST=192.168.1.61 \
DURIAN_UPLOAD_LIMIT=20480 \ DURIAN_API_TOKEN=Q2xpZW50cyBTSE9VTEQgbWFrZSBhdXRoZW50aWNhdGVkIHJlcXVlc3RzIHdpdGggYSBiZWFyZXIgdG9rZW4K \
node backend.js
# æˆ–è€…ä½¿ç”¨ç¼–è¯‘çš„ duriand
DURIAN_HOST=192.168.1.61 DURIAN_UPLOAD_LIMIT=20480 DURIAN_API_TOKEN=... duriand
```

```sh
# è¿è¡Œå®¢æˆ·ç«¯èŠ‚ç‚¹ durianc
# å¯ä»¥åœ¨åŒä¸€ä¸»æœºå¦å¼€ç»ˆç«¯è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨èƒ½è®¿é—®åˆ° http://192.168.1.61:30080 çš„å…¶ä»–ä¸»æœºä¸Šè¿è¡Œ
# æ³¨æ„ï¼ŒDURIAN_HOST å¿…é¡»æ˜¯æœåŠ¡å™¨èŠ‚ç‚¹çš„ IP æˆ–è€…åŸŸå
# å®¢æˆ·ç«¯çš„é¡µé¢åªèƒ½æœ¬åœ°è®¿é—®
# è®¿é—® http://127.0.0.1:30080/ å¯ä»¥æŸ¥çœ‹å®¢æˆ·ç«¯çš„é¡µé¢ï¼Œä½†ç®¡ç†åŠŸèƒ½ä¸å¯ç”¨
DURIAN_HOST=192.168.1.61 node client.js
# æˆ–è€…ä½¿ç”¨ç¼–è¯‘çš„ durianc
DURIAN_HOST=192.168.1.61 durianc
```

æ•°æ®åŒæ­¥æ˜¯å…¨è‡ªåŠ¨çš„ï¼Œä¸éœ€è¦ä»»ä½•å¹²é¢„ã€‚ä½†ç¼ºå°‘ä¸€äº›å¼ºåŒ–çš„ç»†èŠ‚å¤„ç†ï¼Œè¿˜éœ€è¦æ›´å¤šçš„æµ‹è¯•ï¼š
- è¶…æ—¶å¤„ç†ï¼šå½“BTä¸‹è½½è¿Ÿè¿Ÿä¸èƒ½å®Œæˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯BTä¸‹è½½æˆ–è€…é™çº§
- é™çº§æªæ–½ï¼šå’Œå‰ä¸€ä¸ªç›¸å…³ï¼Œå½“ç”¨æˆ·æ— æ³•ä½¿ç”¨BTåè®®æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ° http ä¸‹è½½æ¨¡å¼
- å„ç§æ„å¤–ï¼šæ¯”å¦‚ï¼Œç”¨æˆ·ä¸‹è½½æŸæ•°æ®è¡¨æ—¶ï¼ŒæœåŠ¡å™¨æ›´æ–°äº†æ­¤è¡¨ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯åº”è¯¥è‡ªåŠ¨å–æ¶ˆå½“å‰ä¸‹è½½ä»»åŠ¡ï¼Œç„¶åä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬


</code>

<div id="list">
<details>
<summary>è·å–æŸé¡¹ç›®çš„å¸¸é‡è¡¨æ¸…å•</summary>
<script>
/*
- GET  /sys-const/info-list/:proCode
- POST /sys-const/info-list { proCode }
*/
async function demo_list() {
	const proCode = document.querySelector('#list form [name="proCode"]').value.trim();
	const el = document.querySelector('#list pre');
	el.textContent = 'æ­£åœ¨å¤„ç†'
	const response = await fetch(`/sys-const/info-list/${encodeURIComponent(proCode)}`, {});
	const docs = await response.json();
	el.textContent = JSON.stringify(docs, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_list(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<div class="searchbox">
		<input name="proCode" type="search" placeholder="é¡¹ç›®ç¼–ç " value="B0113" />
		<button aria-label="search"></button>	
	</div>
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>

<div id="search">
<details>
<summary>åˆ†é¡µæŸ¥è¯¢</summary>
<script>
/*
- POST /sys-const/page/:proCode/:name { queryNames, pageSize, pageIndex, sort, respNames }
- POST /sys-const/page { proCode, name, queryNames, pageSize, pageIndex, sort, respNames }
*/
async function demo_page() {
	const query = document.querySelector('#search form [name="query"]').value.trim();
	const el = document.querySelector('#search pre');
	try {
		var data = Hjson.parse(query)
	} catch (error) {
		return el.textContent = 'æ— æ³•è§£ææŸ¥è¯¢æ¡ä»¶';
	}
	el.textContent = 'æ­£åœ¨å¤„ç†';
	const response = await fetch("/sys-const/page", {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify(data),
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const docs = await response.json();
	el.textContent = JSON.stringify(docs, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_page(),false">
	<label>æŸ¥è¯¢æ¡ä»¶</label>
	<textarea name="query" placeholder="æŸ¥è¯¢æ¡ä»¶">{
	proCode: "B0113",
	name: "B0113_ç™¾å¹´ç†èµ”_ç™¾å¹´ç†èµ”åŒ»é™¢ä»£ç è¡¨",
	queryNames:	{
	åŒ»é™¢åç§°: {
		$regex: "/^ä¸Šæµ·å¸‚/",
	},
	},
	sort:	[	{	_id: 1	} ],
	respNames: [ "åŒ»é™¢ç¼–ç ", "åŒ»é™¢åç§°" ]
}</textarea>
	<input type="submit" role="button" value="æŸ¥è¯¢" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>

<div id="import">
<details>
<summary>å¯¼å…¥å¸¸é‡è¡¨</summary>
<script>
/*
- PUT  /sys-const/import/:proCode { files:[...] }
- POST /sys-const/import { proCode, files:[...] }
*/
async function demo_import() {
	const proCode = document.querySelector('#import form [name="proCode"]').value.trim();
	const files = [...document.querySelector('#import form [name="files"]').files];
	const el = document.querySelector('#import pre');
	if (proCode === '' || files.length === 0) return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	const formData = new FormData()
	files.map(file => formData.append("files", file));
	el.textContent = "æ­£åœ¨å¤„ç†";
	const response = await fetch(`/sys-const/import/${encodeURIComponent(proCode)}`, {
		method: "PUT",
		headers: {
			"Authorization": `Bearer ${api_token}`,
		},
		body: formData,
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const result = await response.json();
	el.textContent = JSON.stringify(result, null, 2);
}
</script>
</details>
<form enctype='multipart/form-data' onsubmit="return event.preventDefault(),demo_import(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/>
	<input type="file" name="files" multiple />
	<input type="submit" role="button" value="å¯¼å…¥" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


<div id="insert">
<details>
<summary>æ·»åŠ å¸¸é‡</summary>
<script>
/*
æ‰¹é‡æ·»åŠ å¸¸é‡
- PUT  /sys-const/insert/:proCode/:name { items:[...] }
- POST /sys-const/insert { proCode, name, items:[...] }
*/
async function demo_insert() {
	const proCode = document.querySelector('#insert form [name="proCode"]').value.trim();
	const name = document.querySelector('#insert form [name="name"]').value.trim();
	var items = document.querySelector('#insert form [name="items"]').value.trim();
	const el = document.querySelector('#insert pre');
	if (proCode === '' || name === '' || items === '') return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	try {
		items = Hjson.parse(items)
	} catch (error) {
		return el.textContent = 'æ— æ³•è§£æå¡«å†™çš„å¸¸é‡å†…å®¹';
	}
	if (typeof(items) !== 'object') return el.textContent = 'è¯·é‡æ–°å¡«å†™å¸¸é‡å†…å®¹';
	el.textContent = "æ­£åœ¨å¤„ç†";
	const response = await fetch(`/sys-const/insert/${encodeURIComponent(proCode)}/${encodeURIComponent(name)}`, {
		method: "PUT",
		headers: {
			"Authorization": `Bearer ${api_token}`,
			"Content-Type": "application/json",
	},
		body: JSON.stringify({items}),
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const result = await response.json();
	el.textContent = JSON.stringify(result, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_insert(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/>
	<label>å¸¸é‡è¡¨åç§°</label>
	<input name="name" type="text" placeholder="å¸¸é‡è¡¨åç§°"  value="B0113_ç™¾å¹´ç†èµ”_ç™¾å¹´ç†èµ”èŒä¸šä»£ç è¡¨" /><br>
	<label>æ–°çš„å¸¸é‡</label>
	<textarea name="items" placeholder="æ–°çš„å¸¸é‡ï¼Œæ•°ç»„æˆ–å•ä¸ªæ•°æ®">[
	{
		èŒä¸šç¼–ç : "9000000",
		èŒä¸šåç§°: "æ­¦æ—ç›Ÿä¸»",
	}
]</textarea>
	<input type="submit" role="button" value="æ·»åŠ " />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


<div id="edit">
<details>
<summary>ä¿®æ”¹å¸¸é‡</summary>
<script>
/*
ä¿®æ”¹æŸä¸ªå¸¸é‡
- PATCH /sys-const/edit/:proCode/:name/:id { item }
- POST  /sys-const/edit { proCode, name, id, item }
*/
async function demo_edit() {
	const proCode = document.querySelector('#edit form [name="proCode"]').value.trim();
	const name = document.querySelector('#edit form [name="name"]').value.trim();
	const el = document.querySelector('#edit pre');
	var query = document.querySelector('#edit form [name="query"]').value.trim();
	var item = document.querySelector('#edit form [name="item"]').value.trim();
	if (proCode === '' || name === '' || query === '') return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	try { query = Hjson.parse(query); }
	catch (error) { return el.textContent = 'æ— æ³•è§£æå¡«å†™çš„æŸ¥è¯¢æ¡ä»¶'; }
	if (typeof(query) !== 'object') return el.textContent = 'è¯·é‡æ–°å¡«æŸ¥è¯¢æ¡ä»¶';
	try { item = Hjson.parse(item); }
	catch (error) { return el.textContent = 'æ— æ³•è§£æå¡«å†™çš„ä¿®æ”¹å†…å®¹'; }
	if (typeof(item) !== 'object') return el.textContent = 'è¯·é‡æ–°å¡«å†™ä¿®æ”¹å†…å®¹';
	el.textContent = "æ­£åœ¨å¤„ç†";
	const r1 = await fetch("/sys-const/page", {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify({
			proCode, name,
			queryNames: query,
			pageSize: 1,
		}),
	});
	const o1 = await r1.json();
	if (!o1 || !o1.list) return el.textContent = 'æŸ¥è¯¢å¼‚å¸¸';
	if (!o1.list[0] || !o1.list[0]._id) return el.textContent = `æœªæ‰¾åˆ°æ­¤æ•°æ®`;
	const id = o1.list[0]._id;
	const response = await fetch(`/sys-const/edit/${encodeURIComponent(proCode)}/${encodeURIComponent(name)}/${encodeURIComponent(id)}`, {
		method: "PATCH",
		headers: {
			"Authorization": `Bearer ${api_token}`,
			"Content-Type": "application/json"
		},
		body: JSON.stringify({item}),
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const result = await response.json();
	el.textContent = JSON.stringify(result, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_edit(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/>
	<label>å¸¸é‡è¡¨åç§°</label>
	<input name="name" type="text" placeholder="å¸¸é‡è¡¨åç§°"  value="B0113_ç™¾å¹´ç†èµ”_ç™¾å¹´ç†èµ”èŒä¸šä»£ç è¡¨" /><br>
	<label>æŸ¥è¯¢æ¡ä»¶ï¼Œç”¨äºç¡®å®šä¿®æ”¹å“ªä¸ªæ•°æ®é¡¹</label>
	<textarea name="query" placeholder="æŸ¥è¯¢æ¡ä»¶ï¼Œä¿®æ”¹å“ªä¸ªå¸¸é‡">{
	èŒä¸šç¼–ç : "9000000",
}</textarea>
	<textarea name="item" placeholder="ä¿®æ”¹å†…å®¹">{
	$set: {
		èŒä¸šåç§°: "è—ç»é˜æ‰«åœ°åƒ§",
	}
}</textarea>
	<input type="submit" role="button" value="ä¿®æ”¹" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


<div id="delete">
<details>
<summary>åˆ é™¤å¸¸é‡</summary>
<script>
/*
- DELETE /sys-const/del-lines/:proCode/:name { ids:[...] }
- POST   /sys-const/del-lines { proCode, name, ids:[...] }
*/
async function demo_delete() {
	const proCode = document.querySelector('#delete form [name="proCode"]').value.trim();
	const name = document.querySelector('#delete form [name="name"]').value.trim();
	const el = document.querySelector('#delete pre');
	var queryNames = document.querySelector('#delete form [name="query"]').value.trim();
	if (proCode === '' || name === '' || queryNames === '') return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	try { queryNames = Hjson.parse(queryNames); }
	catch (error) { return el.textContent = 'æ— æ³•è§£æå¡«å†™çš„æŸ¥è¯¢æ¡ä»¶'; }
	if (typeof(queryNames) !== 'object') return el.textContent = 'è¯·é‡æ–°å¡«æŸ¥è¯¢æ¡ä»¶';
	el.textContent = "æ­£åœ¨å¤„ç†";
	const r1 = await fetch("/sys-const/page", {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify({ proCode, name, queryNames, pageSize: 100 }),
	});
	const o1 = await r1.json();
	if (!o1 || !o1.list || !o1.list.length) return el.textContent = 'æŸ¥è¯¢å¼‚å¸¸';
	if (o1.list.length === 0) return el.textContent = `æœªæ‰¾åˆ°æ­¤æ•°æ®`;
	const ids = o1.list.map(o => o._id);
	const response = await fetch(`/sys-const/del-lines/${encodeURIComponent(proCode)}/${encodeURIComponent(name)}`, {
		method: "DELETE",
		headers: {
			"Authorization": `Bearer ${api_token}`,
			"Content-Type": "application/json"
		},
		body: JSON.stringify({ids}),
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const result = await response.json();
	el.textContent = JSON.stringify(result, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_delete(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/>
	<label>å¸¸é‡è¡¨åç§°</label>
	<input name="name" type="text" placeholder="å¸¸é‡è¡¨åç§°"  value="B0113_ç™¾å¹´ç†èµ”_ç™¾å¹´ç†èµ”èŒä¸šä»£ç è¡¨" /><br>
	<label>æŸ¥è¯¢æ¡ä»¶ï¼Œç”¨äºç¡®å®šåˆ é™¤å“ªäº›æ•°æ®é¡¹</label>
	<textarea name="query" placeholder="æŸ¥è¯¢æ¡ä»¶">{
	èŒä¸šç¼–ç : "9000000",
}</textarea>
	<input type="submit" role="button" value="åˆ é™¤" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


<div id="drop-table">
<details>
<summary>åˆ é™¤å¸¸é‡è¡¨</summary>
<script>
/*
- DELETE /sys-const/del-tables/:proCode { name }
- POST   /sys-const/del-tables { proCode, name }
*/
async function demo_drop() {
	const proCode = document.querySelector('#drop-table form [name="proCode"]').value.trim();
	const name = document.querySelector('#drop-table form [name="name"]').value.trim().split(/[\n\r]+/).map(line => line.trim()).filter(line => line !== '');
	const el = document.querySelector('#drop-table pre');
	if (proCode === '' || name.length === 0) return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	el.textContent = "æ­£åœ¨å¤„ç†";
	const response = await fetch(`/sys-const/del-tables/${encodeURIComponent(proCode)}`, {
		method: "DELETE",
		headers: {
			"Authorization": `Bearer ${api_token}`,
			"Content-Type": "application/json"
		},
		body: JSON.stringify({name}),
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const result = await response.json();
	el.textContent = JSON.stringify(result, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_drop(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/><br>
	<label>å¸¸é‡è¡¨åç§°ï¼Œä¸€è¡Œä¸€ä¸ª</label>
	<textarea name="name" placeholder="å¸¸é‡è¡¨åç§°"></textarea>
	<input type="submit" role="button" value="åˆ é™¤" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


<div id="export">
<details>
<summary>å¯¼å‡ºå¸¸é‡è¡¨</summary>
<script>
/*
å¯¼å‡ºä¸€ä¸ªå¸¸é‡è¡¨ï¼Œä¸‹è½½æ ¼å¼ä¸º xlsx
- GET  /sys-const/export/:proCode/:name
- POST /sys-const/export { proCode, name }
*/
async function demo_export() {
	const proCode = document.querySelector('#export form [name="proCode"]').value.trim();
	const name = document.querySelector('#export form [name="name"]').value.trim();
	const el = document.querySelector('#export pre');
	if (proCode === '' || name === '') return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	el.outerHTML = `<pre>
<a href="/sys-const/export/${encodeURIComponent(proCode)}/${encodeURIComponent(name)}?api_token=${encodeURIComponent(api_token)}" target="_blank" download>ç‚¹å‡»è¿™é‡Œä¸‹è½½</a>
</pre>`
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_export(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/>
	<label>å¸¸é‡è¡¨åç§°</label>
	<input name="name" type="text" placeholder="å¸¸é‡è¡¨åç§°" value="B0113_ç™¾å¹´ç†èµ”_ç™¾å¹´ç†èµ”èŒä¸šä»£ç è¡¨" />
	<input type="submit" role="button" value="å¯¼å‡º" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


<div id="release">
<details>
<summary>å‘å¸ƒæ›´æ–°</summary>
<script>
/*
- PATCH /sys-const/release/:proCode { name: [...] }
- POST  /sys-const/release { proCode, name: [...] }
*/
async function demo_release() {
	const proCode = document.querySelector('#release form [name="proCode"]').value.trim();
	const name = document.querySelector('#release form [name="name"]').value.trim().split(/[\n\r]+/).map(line => line.trim()).filter(line => line !== '');
	const el = document.querySelector('#release pre');
	if (proCode === '' || name.length === 0) return el.textContent = "ğŸ‘† è¡¨å•ä¸å®Œæ•´";
	el.textContent = "æ­£åœ¨å¤„ç†";
	const response = await fetch(`/sys-const/release/${encodeURIComponent(proCode)}`, {
		method: "PATCH",
		headers: {
			"Authorization": `Bearer ${api_token}`,
			"Content-Type": "application/json"
		},
		body: JSON.stringify({name}),
	});
	if (response.status >= 400) {
		return el.textContent = `HTTP/${response.status} ${response.statusText}\n${
			await response.text()
		}`;
	}
	const result = await response.json();
	el.textContent = JSON.stringify(result, null, 2);
}
</script>
</details>
<form onsubmit="return event.preventDefault(),demo_release(),false">
	<label>é¡¹ç›®ç¼–ç </label>
	<input name="proCode" type="text" placeholder="é¡¹ç›®ç¼–ç " value="B0113"/><br>
	<label>å¸¸é‡è¡¨åç§°ï¼Œä¸€è¡Œä¸€ä¸ª</label>
	<textarea name="name" placeholder="å¸¸é‡è¡¨åç§°"></textarea>
	<input type="submit" role="button" value="å‘å¸ƒ" />
</form>
<details open>
	<summary>ç»“æœ</summary>
	<pre>æ­¤å¤„æ˜¾ç¤ºæ“ä½œç»“æœ</pre>
</details>
</div>


</main>
<script src="lib/hjson.min.js"></script>
<script>
// æ£€æŸ¥å°šæœªå®ç°çš„åŠŸèƒ½
;(_ =>{
	[...document.querySelectorAll('aside a')].map(a => {
		const href = a.getAttribute('href');
		if (href[0] != '#') return
		const el = document.querySelector(href);
		if (el) return
		a.toggleAttribute('disabled', true);
		console.debug('disable', href);
	})
})();
// å¤„ç† api_token
try {
	var api_token = location.search.slice(1).split('&').filter(o => o.indexOf("api_token=") === 0)[0].slice(10)
} catch (error) {}
if (!api_token) alert('æœªè®¾ç½® api_token');
</script>
</body>

</html>